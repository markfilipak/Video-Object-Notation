<!DOCTYPE html>
<HTML>
<HEAD>
<META http-equiv="content-type" content="text/html; charset=utf-8">
<META http-equiv="content-language" content="en">
<META http-equiv="cache-control" content="no-cache">
<META http-equiv="expires" content="Thu, 01 Jan 1970 00:00:00 GMT">
<META http-equiv="pragma" content="no-cache">
<META http-equiv="content-style-type" content="text/css">
<LINK href="OFFmpeg.css" rel="stylesheet" type="text/css">
<META http-equiv="content-script-type" content="text/javascript">
<SCRIPT src="OFFmpeg.js"></SCRIPT>

<TITLE>GOP - PTS-order - DTS-order</TITLE>
</HEAD>
<BODY>

<B class="big">GOP & Frame Reordering</B> —— <I>visualizing how decoders reorder frames while they are decoding.</I><BR><BR>

A group of pictures (GOP) is an I-frame followed by P-frames and optional B-frames.
There's an actual specimen below.
The specimen GOP has 25 frames.
Those 25 frames are followed by the I-frame of the next GOP — a total of 26 frames.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box1111"><TR><TD><PRE class="white">
GOP specimen     now                          ——— frame time ———>                            later
                    [<B>I</B>][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][B][I]
</PRE></TD></TR></TABLE>
Below are the steps decoders take. While looking at them, remember that time is plastic in virtual space.
The first step is called <I>reordering</I>.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box1111"><TR><TD><PRE class="white">
PTS order        now                          ——— frame time ———>                            later
(viewing order)     <SPAN style="color:gray"><B>[I]</B>[B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][B][I]</SPAN>
                    <SPAN style="color:gray">/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦__¦_/</SPAN>
DTS order         <SPAN style="color:gray"> /  / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦  ¦</SPAN>
(decoding order) <B>[I]</B>[P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]
</PRE></TD></TR></TABLE>

<BR>
Now imagine a virtual conveyor that points downstream.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box1111"><TR><TD><PRE class="white">
              .——<B>[I]</B>[P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]
             (•
              `—————————————————————————————————————conveyor——————————————————————————————————>  &nbsp;
</PRE></TD></TR></TABLE>
As they are dropped on the conveyor, the frames seem to be put in reverse order, but they're not reversed to the downstream of course.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box1111"><TR><TD><PRE class="white">
              .——[P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]<——
  decode <B>[I]</B> (• I-frames are complete unto themselves
              `———<B>I</B>—————————————————————————————————conveyor——————————————————————————————————>  &nbsp;
</PRE></TD></TR></TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box0111"><TR><TD><PRE class="white">
              .——[B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]<——
  decode [P] (• P-frames are <I>predictive</I> based on differences with <B>I</B>
              `——>P—><B>I</B>——————————————————————————————conveyor——————————————————————————————————>  &nbsp;
</PRE></TD></TR></TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box0111"><TR><TD><PRE class="white">
              .——[P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]<——
  decode [B] (• B-frames are <I>bipredictive</I> based on differences with P and with <B>I</B>
              `——>B—>P—><B>I</B>———————————————————————————conveyor——————————————————————————————————>  &nbsp;
</PRE></TD></TR></TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box0111"><TR><TD><PRE class="white">
              .——[B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]<——
  decode [P] (• P-frames are <I>predictive</I> based on differences with <B>I</B>
              `——>P—>B—>P—><B>I</B>————————————————————————conveyor——————————————————————————————————>  &nbsp;
</PRE></TD></TR></TABLE>

<BR>
As the 25 frames are decoded and rendered, they are put back into PTS order for the trip downstream.
The next GOP's I-frame, which has already been decoded, is placed at the conveyor's front end, ready for the P- and B-frames that follow.
Note that the I-frames that head GOPs are sometimes called <I>keyframes</I>.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 class="box1111"><TR><TD><PRE class="white">
                    <SPAN style="color:gray">[B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][B][I]</SPAN>
                    <SPAN style="color:gray">_¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦__¦_/</SPAN>
                  <SPAN style="color:gray"> / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦  ¦</SPAN>
              .——[P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][P][B][I][B][B]
             (•
              `———I—————————————————————————————————conveyor——————————————————————————————————>  &nbsp;
                   <SPAN style="color:gray">\___
                       \</SPAN>
DTS order         <SPAN style="color:gray">B  B  I  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  <B>I</B>
                  ¦  ¦    _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  _¦_/  /
                  ¦  ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   / ¦   /</SPAN>
PTS order         B  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  P  B  <B>I</B> —————>
(viewing order)                                                                         downstream
</PRE></TD></TR></TABLE>
ITU-T H.262 (02/2012), section 3.70 states: "Frame re-ordering occurs when B-frames are present in a bitstream."<BR>

<BR></BODY></HTML>
